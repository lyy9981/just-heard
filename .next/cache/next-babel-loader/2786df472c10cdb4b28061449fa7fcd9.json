{"ast":null,"code":"var _jsxFileName = \"/Users/yiyi/projects/just-heard/components/SearchBar.js\";\nvar __jsx = React.createElement;\nimport React, { useState } from 'react';\nimport { useQuery } from '@apollo/react-hooks';\nimport { useRouter } from 'next/router';\nimport parse from 'autosuggest-highlight/parse';\nimport match from 'autosuggest-highlight/match';\nimport { fade, makeStyles } from '@material-ui/core/styles';\nimport InputBase from '@material-ui/core/InputBase';\nimport Autocomplete from '@material-ui/lab/Autocomplete';\nimport SearchIcon from '@material-ui/icons/Search';\nimport SEARCH_TOPICS from '../queries/searchTopics';\nimport { useLocale } from \"../contexts/localeProvider\";\nconst useStyles = makeStyles(theme => ({\n  root: {\n    maxWidth: '300px'\n  },\n  search: {\n    position: 'relative',\n    borderRadius: theme.shape.borderRadius,\n    backgroundColor: theme.palette.background.light,\n    '&:hover': {\n      backgroundColor: fade(theme.palette.background.light, 0.75)\n    },\n    marginLeft: theme.spacing(2),\n    width: `100% - ${theme.spacing(2)}px`,\n    [theme.breakpoints.up('sm')]: {\n      marginLeft: theme.spacing(1),\n      width: 'auto'\n    }\n  },\n  searchIcon: {\n    color: theme.palette.text.secondary,\n    padding: theme.spacing(0, 1),\n    height: '100%',\n    position: 'absolute',\n    pointerEvents: 'none',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    [theme.breakpoints.up('sm')]: {\n      padding: theme.spacing(0, 2)\n    }\n  },\n  inputRoot: {\n    color: 'inherit'\n  },\n  inputInput: {\n    color: theme.palette.text.secondary,\n    padding: theme.spacing(1, 1, 1, 0),\n    paddingLeft: `calc(1em + ${theme.spacing(3)}px)`,\n    transition: theme.transitions.create('width'),\n    width: '100%',\n    [theme.breakpoints.up('sm')]: {\n      paddingLeft: `calc(1em + ${theme.spacing(4)}px)`,\n      width: '12ch',\n      '&:focus': {\n        width: '20ch'\n      }\n    }\n  }\n}));\n\nfunction SearchBar() {\n  var _data$search_topics;\n\n  const {\n    citySlug\n  } = useLocale();\n  const {\n    push\n  } = useRouter();\n  const {\n    0: suggestion,\n    1: setSuggestion\n  } = useState('');\n  const isSkip = !suggestion || suggestion.length < 2 || !citySlug;\n  const classes = useStyles();\n  const {\n    data,\n    loading\n  } = useQuery(SEARCH_TOPICS, {\n    skip: isSkip,\n    variables: {\n      slug: citySlug,\n      keyword: suggestion\n    },\n    // fix apollo 'skip' bug. 'cache-first' is default fetchPolicy\n    fetchPolicy: isSkip ? 'cache-only' : 'cache-first'\n  });\n  const options = (data === null || data === void 0 ? void 0 : (_data$search_topics = data.search_topics) === null || _data$search_topics === void 0 ? void 0 : _data$search_topics.map(item => {\n    var _item$phrase;\n\n    return item === null || item === void 0 ? void 0 : (_item$phrase = item.phrase) === null || _item$phrase === void 0 ? void 0 : _item$phrase.name;\n  })) || [];\n  return __jsx(\"div\", {\n    className: classes.root,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 5\n    }\n  }, __jsx(Autocomplete, {\n    freeSolo: true,\n    size: \"small\",\n    options: options,\n    loading: loading,\n    renderInput: params => __jsx(\"div\", {\n      className: classes.search,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 11\n      }\n    }, __jsx(\"div\", {\n      className: classes.searchIcon,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 13\n      }\n    }, __jsx(SearchIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 15\n      }\n    })), __jsx(InputBase, {\n      ref: params.InputProps.ref,\n      inputProps: params.inputProps,\n      placeholder: \"Search\\u2026\",\n      classes: {\n        root: classes.inputRoot,\n        input: classes.inputInput\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 13\n      }\n    })),\n    renderOption: (option, {\n      inputValue\n    }) => {\n      const matches = match(option, inputValue);\n      const parts = parse(option, matches);\n      return __jsx(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 13\n        }\n      }, parts.map((part, index) => __jsx(\"span\", {\n        key: index,\n        style: {\n          fontWeight: part.highlight ? 700 : 400\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 17\n        }\n      }, part.text)));\n    },\n    onChange: (event, newValue) => {\n      if (newValue) {\n        push('/[slug]/search/[keyword]', `/${citySlug}/search/${newValue === null || newValue === void 0 ? void 0 : newValue.toLowerCase()}`);\n      }\n    },\n    onInputChange: (event, newInputValue) => {\n      setSuggestion(newInputValue);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }\n  }));\n}\n\nexport default SearchBar;","map":{"version":3,"names":["React","useState","useQuery","useRouter","parse","match","fade","makeStyles","InputBase","Autocomplete","SearchIcon","SEARCH_TOPICS","useLocale","useStyles","theme","root","maxWidth","search","position","borderRadius","shape","backgroundColor","palette","background","light","marginLeft","spacing","width","breakpoints","up","searchIcon","color","text","secondary","padding","height","pointerEvents","display","alignItems","justifyContent","inputRoot","inputInput","paddingLeft","transition","transitions","create","SearchBar","citySlug","push","suggestion","setSuggestion","isSkip","length","classes","data","loading","skip","variables","slug","keyword","fetchPolicy","options","search_topics","map","item","phrase","name","params","InputProps","ref","inputProps","input","option","inputValue","matches","parts","part","index","fontWeight","highlight","event","newValue","toLowerCase","newInputValue"],"sources":["/Users/yiyi/projects/just-heard/components/SearchBar.js"],"sourcesContent":["import React, { useState } from 'react'\nimport { useQuery } from '@apollo/react-hooks'\nimport { useRouter } from 'next/router'\nimport parse from 'autosuggest-highlight/parse'\nimport match from 'autosuggest-highlight/match'\nimport { fade, makeStyles } from '@material-ui/core/styles'\nimport InputBase from '@material-ui/core/InputBase'\nimport Autocomplete from '@material-ui/lab/Autocomplete'\nimport SearchIcon from '@material-ui/icons/Search'\nimport SEARCH_TOPICS from '../queries/searchTopics'\nimport { useLocale } from \"../contexts/localeProvider\"\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    maxWidth: '300px',\n  },\n  search: {\n    position: 'relative',\n    borderRadius: theme.shape.borderRadius,\n    backgroundColor: theme.palette.background.light,\n    '&:hover': {\n      backgroundColor: fade(theme.palette.background.light, 0.75),\n    },\n    marginLeft: theme.spacing(2),\n    width: `100% - ${theme.spacing(2)}px`,\n    [theme.breakpoints.up('sm')]: {\n      marginLeft: theme.spacing(1),\n      width: 'auto',\n    },\n  },\n  searchIcon: {\n    color: theme.palette.text.secondary,\n    padding: theme.spacing(0, 1),\n    height: '100%',\n    position: 'absolute',\n    pointerEvents: 'none',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    [theme.breakpoints.up('sm')]: {\n      padding: theme.spacing(0, 2),\n    },\n  },\n  inputRoot: {\n    color: 'inherit',\n  },\n  inputInput: {\n    color: theme.palette.text.secondary,\n    padding: theme.spacing(1, 1, 1, 0),\n    paddingLeft: `calc(1em + ${theme.spacing(3)}px)`,\n    transition: theme.transitions.create('width'),\n    width: '100%',\n    [theme.breakpoints.up('sm')]: {\n      paddingLeft: `calc(1em + ${theme.spacing(4)}px)`,\n      width: '12ch',\n      '&:focus': {\n        width: '20ch',\n      },\n    },\n  },\n}))\n\nfunction SearchBar() {\n  const { citySlug } = useLocale()\n  const { push } = useRouter()\n  const [suggestion, setSuggestion] = useState('')\n  const isSkip = !suggestion || suggestion.length < 2 || !citySlug\n\n  const classes = useStyles()\n  const { data, loading } = useQuery(SEARCH_TOPICS, {\n    skip: isSkip,\n\n    variables: {\n      slug: citySlug,\n      keyword: suggestion,\n    },\n\n    // fix apollo 'skip' bug. 'cache-first' is default fetchPolicy\n    fetchPolicy: isSkip ? 'cache-only' : 'cache-first'\n  })\n  const options = data?.search_topics?.map(item => item?.phrase?.name) || []\n\n  return (\n    <div className={classes.root}>\n      <Autocomplete\n        freeSolo\n        size=\"small\"\n        options={options}\n        loading={loading}\n        renderInput={(params) => (\n          <div className={classes.search}>\n            <div className={classes.searchIcon}>\n              <SearchIcon />\n            </div>\n            <InputBase\n              ref={params.InputProps.ref}\n              inputProps={params.inputProps}\n              placeholder=\"Searchâ€¦\"\n              classes={{\n                root: classes.inputRoot,\n                input: classes.inputInput,\n              }}\n            />\n          </div>\n        )}\n        renderOption={(option, { inputValue }) => {\n          const matches = match(option, inputValue);\n          const parts = parse(option, matches);\n\n          return (\n            <div>\n              {parts.map((part, index) => (\n                <span key={index} style={{ fontWeight: part.highlight ? 700 : 400 }}>\n                {part.text}\n              </span>\n              ))}\n            </div>\n          );\n        }}\n        onChange={(event, newValue) => {\n          if (newValue) {\n            push('/[slug]/search/[keyword]', `/${citySlug}/search/${newValue?.toLowerCase()}`)\n          }\n        }}\n        onInputChange={(event, newInputValue) => {\n          setSuggestion(newInputValue)\n        }}\n      />\n    </div>\n  );\n}\n\nexport default SearchBar\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}