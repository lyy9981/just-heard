{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nvar _jsxFileName = \"/Users/yiyi/projects/just-heard/components/SearchBar.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useState } from 'react';\nimport { useQuery } from '@apollo/react-hooks';\nimport { useRouter } from 'next/router';\nimport parse from 'autosuggest-highlight/parse';\nimport match from 'autosuggest-highlight/match';\nimport { fade, makeStyles } from '@material-ui/core/styles';\nimport InputBase from '@material-ui/core/InputBase';\nimport Autocomplete from '@material-ui/lab/Autocomplete';\nimport SearchIcon from '@material-ui/icons/Search';\nimport SEARCH_TOPICS from '../queries/searchTopics';\nimport { useLocale } from \"../contexts/localeProvider\";\nvar useStyles = makeStyles(function (theme) {\n  return {\n    root: {\n      maxWidth: '300px'\n    },\n    search: _defineProperty({\n      position: 'relative',\n      borderRadius: theme.shape.borderRadius,\n      backgroundColor: theme.palette.background.light,\n      '&:hover': {\n        backgroundColor: fade(theme.palette.background.light, 0.75)\n      },\n      marginLeft: theme.spacing(2),\n      width: \"100% - \".concat(theme.spacing(2), \"px\")\n    }, theme.breakpoints.up('sm'), {\n      marginLeft: theme.spacing(1),\n      width: 'auto'\n    }),\n    searchIcon: _defineProperty({\n      color: theme.palette.text.secondary,\n      padding: theme.spacing(0, 1),\n      height: '100%',\n      position: 'absolute',\n      pointerEvents: 'none',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center'\n    }, theme.breakpoints.up('sm'), {\n      padding: theme.spacing(0, 2)\n    }),\n    inputRoot: {\n      color: 'inherit'\n    },\n    inputInput: _defineProperty({\n      color: theme.palette.text.secondary,\n      padding: theme.spacing(1, 1, 1, 0),\n      paddingLeft: \"calc(1em + \".concat(theme.spacing(3), \"px)\"),\n      transition: theme.transitions.create('width'),\n      width: '100%'\n    }, theme.breakpoints.up('sm'), {\n      paddingLeft: \"calc(1em + \".concat(theme.spacing(4), \"px)\"),\n      width: '12ch',\n      '&:focus': {\n        width: '20ch'\n      }\n    })\n  };\n});\n\nfunction SearchBar() {\n  _s();\n\n  var _data$search_topics,\n      _this = this;\n\n  var _useLocale = useLocale(),\n      citySlug = _useLocale.citySlug;\n\n  var _useRouter = useRouter(),\n      push = _useRouter.push;\n\n  var _useState = useState(''),\n      suggestion = _useState[0],\n      setSuggestion = _useState[1];\n\n  var isSkip = !suggestion || suggestion.length < 2 || !citySlug;\n  var classes = useStyles();\n\n  var _useQuery = useQuery(SEARCH_TOPICS, {\n    skip: isSkip,\n    variables: {\n      slug: citySlug,\n      keyword: suggestion\n    },\n    // fix apollo 'skip' bug. 'cache-first' is default fetchPolicy\n    fetchPolicy: isSkip ? 'cache-only' : 'cache-first'\n  }),\n      data = _useQuery.data,\n      loading = _useQuery.loading;\n\n  var options = (data === null || data === void 0 ? void 0 : (_data$search_topics = data.search_topics) === null || _data$search_topics === void 0 ? void 0 : _data$search_topics.map(function (item) {\n    var _item$phrase;\n\n    return item === null || item === void 0 ? void 0 : (_item$phrase = item.phrase) === null || _item$phrase === void 0 ? void 0 : _item$phrase.name;\n  })) || [];\n  return __jsx(\"div\", {\n    className: classes.root,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 5\n    }\n  }, __jsx(Autocomplete, {\n    freeSolo: true,\n    size: \"small\",\n    options: options,\n    loading: loading,\n    renderInput: function renderInput(params) {\n      return __jsx(\"div\", {\n        className: classes.search,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 11\n        }\n      }, __jsx(\"div\", {\n        className: classes.searchIcon,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 13\n        }\n      }, __jsx(SearchIcon, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 15\n        }\n      })), __jsx(InputBase, {\n        ref: params.InputProps.ref,\n        inputProps: params.inputProps,\n        placeholder: \"Search\\u2026\",\n        classes: {\n          root: classes.inputRoot,\n          input: classes.inputInput\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 13\n        }\n      }));\n    },\n    renderOption: function renderOption(option, _ref) {\n      var inputValue = _ref.inputValue;\n      var matches = match(option, inputValue);\n      var parts = parse(option, matches);\n      return __jsx(\"div\", {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 13\n        }\n      }, parts.map(function (part, index) {\n        return __jsx(\"span\", {\n          key: index,\n          style: {\n            fontWeight: part.highlight ? 700 : 400\n          },\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 113,\n            columnNumber: 17\n          }\n        }, part.text);\n      }));\n    },\n    onChange: function onChange(event, newValue) {\n      if (newValue) {\n        push('/[slug]/search/[keyword]', \"/\".concat(citySlug, \"/search/\").concat(newValue === null || newValue === void 0 ? void 0 : newValue.toLowerCase()));\n      }\n    },\n    onInputChange: function onInputChange(event, newInputValue) {\n      setSuggestion(newInputValue);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }\n  }));\n}\n\n_s(SearchBar, \"q/T67HaC56wiDvYT1seyNRd6DVc=\", false, function () {\n  return [useLocale, useRouter, useStyles, useQuery];\n});\n\n_c = SearchBar;\nexport default SearchBar;\n\nvar _c;\n\n$RefreshReg$(_c, \"SearchBar\");","map":{"version":3,"names":["React","useState","useQuery","useRouter","parse","match","fade","makeStyles","InputBase","Autocomplete","SearchIcon","SEARCH_TOPICS","useLocale","useStyles","theme","root","maxWidth","search","position","borderRadius","shape","backgroundColor","palette","background","light","marginLeft","spacing","width","breakpoints","up","searchIcon","color","text","secondary","padding","height","pointerEvents","display","alignItems","justifyContent","inputRoot","inputInput","paddingLeft","transition","transitions","create","SearchBar","citySlug","push","suggestion","setSuggestion","isSkip","length","classes","skip","variables","slug","keyword","fetchPolicy","data","loading","options","search_topics","map","item","phrase","name","params","InputProps","ref","inputProps","input","option","inputValue","matches","parts","part","index","fontWeight","highlight","event","newValue","toLowerCase","newInputValue"],"sources":["/Users/yiyi/projects/just-heard/components/SearchBar.js"],"sourcesContent":["import React, { useState } from 'react'\nimport { useQuery } from '@apollo/react-hooks'\nimport { useRouter } from 'next/router'\nimport parse from 'autosuggest-highlight/parse'\nimport match from 'autosuggest-highlight/match'\nimport { fade, makeStyles } from '@material-ui/core/styles'\nimport InputBase from '@material-ui/core/InputBase'\nimport Autocomplete from '@material-ui/lab/Autocomplete'\nimport SearchIcon from '@material-ui/icons/Search'\nimport SEARCH_TOPICS from '../queries/searchTopics'\nimport { useLocale } from \"../contexts/localeProvider\"\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    maxWidth: '300px',\n  },\n  search: {\n    position: 'relative',\n    borderRadius: theme.shape.borderRadius,\n    backgroundColor: theme.palette.background.light,\n    '&:hover': {\n      backgroundColor: fade(theme.palette.background.light, 0.75),\n    },\n    marginLeft: theme.spacing(2),\n    width: `100% - ${theme.spacing(2)}px`,\n    [theme.breakpoints.up('sm')]: {\n      marginLeft: theme.spacing(1),\n      width: 'auto',\n    },\n  },\n  searchIcon: {\n    color: theme.palette.text.secondary,\n    padding: theme.spacing(0, 1),\n    height: '100%',\n    position: 'absolute',\n    pointerEvents: 'none',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    [theme.breakpoints.up('sm')]: {\n      padding: theme.spacing(0, 2),\n    },\n  },\n  inputRoot: {\n    color: 'inherit',\n  },\n  inputInput: {\n    color: theme.palette.text.secondary,\n    padding: theme.spacing(1, 1, 1, 0),\n    paddingLeft: `calc(1em + ${theme.spacing(3)}px)`,\n    transition: theme.transitions.create('width'),\n    width: '100%',\n    [theme.breakpoints.up('sm')]: {\n      paddingLeft: `calc(1em + ${theme.spacing(4)}px)`,\n      width: '12ch',\n      '&:focus': {\n        width: '20ch',\n      },\n    },\n  },\n}))\n\nfunction SearchBar() {\n  const { citySlug } = useLocale()\n  const { push } = useRouter()\n  const [suggestion, setSuggestion] = useState('')\n  const isSkip = !suggestion || suggestion.length < 2 || !citySlug\n\n  const classes = useStyles()\n  const { data, loading } = useQuery(SEARCH_TOPICS, {\n    skip: isSkip,\n\n    variables: {\n      slug: citySlug,\n      keyword: suggestion,\n    },\n\n    // fix apollo 'skip' bug. 'cache-first' is default fetchPolicy\n    fetchPolicy: isSkip ? 'cache-only' : 'cache-first'\n  })\n  const options = data?.search_topics?.map(item => item?.phrase?.name) || []\n\n  return (\n    <div className={classes.root}>\n      <Autocomplete\n        freeSolo\n        size=\"small\"\n        options={options}\n        loading={loading}\n        renderInput={(params) => (\n          <div className={classes.search}>\n            <div className={classes.searchIcon}>\n              <SearchIcon />\n            </div>\n            <InputBase\n              ref={params.InputProps.ref}\n              inputProps={params.inputProps}\n              placeholder=\"Search…\"\n              classes={{\n                root: classes.inputRoot,\n                input: classes.inputInput,\n              }}\n            />\n          </div>\n        )}\n        renderOption={(option, { inputValue }) => {\n          const matches = match(option, inputValue);\n          const parts = parse(option, matches);\n\n          return (\n            <div>\n              {parts.map((part, index) => (\n                <span key={index} style={{ fontWeight: part.highlight ? 700 : 400 }}>\n                {part.text}\n              </span>\n              ))}\n            </div>\n          );\n        }}\n        onChange={(event, newValue) => {\n          if (newValue) {\n            push('/[slug]/search/[keyword]', `/${citySlug}/search/${newValue?.toLowerCase()}`)\n          }\n        }}\n        onInputChange={(event, newInputValue) => {\n          setSuggestion(newInputValue)\n        }}\n      />\n    </div>\n  );\n}\n\nexport default SearchBar\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}